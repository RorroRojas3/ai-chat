<div
  class="offcanvas offcanvas-start menu-offcanvas p-2"
  data-bs-scroll="true"
  tabindex="-1"
  id="menu-offcanvas"
  aria-labelledby="offcanvasWithBothOptionsLabel"
>
  <div
    class="offcanvas-header menu-offcanvas__header menu-offcanvas__header--no-border p-2"
  >
    <h6
      class="offcanvas-title menu-offcanvas__title"
      id="offcanvasWithBothOptionsLabel"
    >
      <img
        src="ai-copihue-icon.svg"
        alt="AI Copihue Icon"
        width="32"
        height="32"
        class="me-2"
      />
    </h6>
    <button
      type="button"
      class="btn-close menu-offcanvas__close-btn"
      data-bs-dismiss="offcanvas"
      aria-label="Close"
    ></button>
  </div>
  <div class="offcanvas-body menu-offcanvas__body p-2">
    <ul class="list-group menu-list mb-2">
      <button
        type="button"
        class="list-group-item list-group-item-action menu-list__item"
        (click)="onClickCreateNewSession()"
      >
        <i class="bi bi-plus-circle"></i>&nbsp;New Chat
      </button>
    </ul>
    <ul class="list-group menu-list mb-2">
      <button
        type="button"
        class="list-group-item list-group-item-action menu-list__item"
        (click)="onClickGoToChats()"
      >
        <i class="bi bi-chat-text"></i>&nbsp;Chats
      </button>
    </ul>
    <ul class="list-group menu-list mb-2">
      <button
        type="button"
        class="list-group-item list-group-item-action menu-list__item"
        (click)="onClickGoToProjects()"
      >
        <i class="bi bi-folder"></i>&nbsp;Projects
      </button>
    </ul>

    <!-- Search functionality -->
    <div class="mb-3">
      <label for="session-search" class="visually-hidden">Search chats</label>
      <div class="input-group">
        <span class="input-group-text menu-search__icon" aria-hidden="true">
          <i class="bi bi-search"></i>
        </span>
        <input
          id="session-search"
          type="text"
          class="form-control menu-search__input"
          placeholder="Search chats..."
          [value]="storeService.menuSessionSearchFilter()"
          (input)="onSearchChange($event)"
          aria-label="Search chat sessions"
          aria-describedby="search-help"
        />
        @if (storeService.menuSessionSearchFilter()) {
        <button
          class="btn btn-outline-secondary menu-search__clear"
          type="button"
          (click)="clearSearch()"
          aria-label="Clear search"
        >
          <i class="bi bi-x"></i>
        </button>
        }
      </div>
      <span id="search-help" class="visually-hidden"
        >Type to search your chat sessions</span
      >
    </div>

    <h6 class="offcanvas-title menu-section-title">Recent Chats</h6>
    <ul class="list-group menu-list" role="list">
      @if (storeService.menuIsSessionSearching()) {
      <li
        class="list-group-item menu-list__item menu-list__item--loading"
        role="status"
        aria-live="polite"
      >
        <i class="bi bi-search me-2"></i>
        Searching...
      </li>
      } @else { @for (session of storeService.menuSessions(); track
      trackBySessionId($index, session)) {
      <li
        class="list-group-item list-group-item-action menu-list__item d-flex justify-content-between align-items-center"
        [class.menu-list__item--active]="isCurrentSession(session.id)"
        role="listitem"
      >
        <button
          type="button"
          class="flex-grow-1 text-white text-decoration-none bg-transparent border-0 text-start p-0"
          (click)="onClickSession(session.id)"
          [attr.aria-label]="'Open chat: ' + session.name"
          [attr.aria-current]="isCurrentSession(session.id) ? 'page' : null"
        >
          {{ getTruncatedSessionName(session) }}
        </button>
        @if (isCurrentSession(session.id)) {
        <div class="dropdown ms-2">
          <button
            class="btn btn-link p-1 text-white dropdown-toggle"
            type="button"
            [attr.id]="'dropdownMenu-' + session.id"
            [attr.aria-label]="'Actions for ' + session.name"
            data-bs-toggle="dropdown"
            aria-expanded="false"
            (click)="$event.stopPropagation()"
          >
            <i class="bi bi-three-dots-vertical"></i>
          </button>
          <ul
            class="dropdown-menu"
            [attr.aria-labelledby]="'dropdownMenu-' + session.id"
          >
            <li>
              <button
                type="button"
                class="dropdown-item"
                (click)="onRenameSession(session.id, $event)"
              >
                <i class="bi bi-pencil me-2"></i>Rename
              </button>
            </li>
          </ul>
        </div>
        }
      </li>
      } @empty { @if (storeService.menuSessionSearchFilter()) {
      <li
        class="list-group-item menu-list__item menu-list__item--no-results"
        role="status"
        aria-live="polite"
      >
        <i class="bi bi-search me-2"></i>
        No chats found for "{{ storeService.menuSessionSearchFilter() }}"
      </li>
      } } }
    </ul>
  </div>
</div>

<app-session-rename-modal
  [show]="showRenameModal"
  [name]="storeService.session()?.name ?? ''"
  (onClose)="onCloseRenameModal()"
  (onRename)="handleRenameSession($event)"
></app-session-rename-modal>
